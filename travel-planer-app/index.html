<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Planner — Travel Rules</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#29606D">
    <style>
        :root {
            --primary: #29606D;
            --primary-dark: #1e4650;
            --accent: #DDAA4F;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --success: #22c55e;
            --danger: #ef4444;
            --header-text: #ffffff;
            --input-bg: #ffffff;
        }

        [data-theme="dark"] {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
            --header-text: #ffffff;
            --primary: #334155;
            --input-bg: #1e293b;
        }

        * { box-sizing: border-box; font-family: 'Inter', system-ui, -apple-system, sans-serif; transition: background-color 0.2s, color 0.2s; }
        body { background-color: var(--bg); color: var(--text); margin: 0; padding-bottom: 110px; line-height: 1.5; }

        header {
            background: rgba(255,255,255,0.86);
            color: var(--text);
            padding: 0.9rem 1rem;
            border-bottom: 1px solid rgba(0,0,0,0.08);
            box-shadow: none;
            position: sticky;
            top: 0;
            z-index: 1100;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }
        [data-theme="dark"] header{
            background: rgba(16,16,16,0.72);
            border-bottom: 1px solid rgba(255,255,255,0.12);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            gap: 12px;
        }

        .brand{
            display:flex;
            align-items:center;
            gap:10px;
            text-decoration:none;
            color: inherit;
            font-weight: 800;
            letter-spacing: .2px;
            min-width: 0;
        }
        .brand-mark{
            display:inline-flex;
            align-items:center;
            justify-content:center;
            width: 34px;
            height: 34px;
            border-radius: 10px;
            color: #fff;
            background: var(--primary);
            box-shadow: 0 10px 20px rgba(0,0,0,.12);
            font-size: 13px;
            flex: 0 0 auto;
        }
        .brand-name{
            font-size: 0.95rem;
            font-weight: 800;
            white-space: nowrap;
        }

        .settings-bar { display: flex; gap: 10px; align-items: center; flex: 0 0 auto; }

        .settings-select {
            height: 36px;
            background: transparent;
            border: 1px solid rgba(0,0,0,0.12);
            color: var(--text);
            padding: 0 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            cursor: pointer;
            font-weight: 800;
            letter-spacing: .4px;
        }
        [data-theme="dark"] .settings-select{ border-color: rgba(255,255,255,0.18); }
        .settings-select:hover{ border-color: var(--accent); }
        .settings-select option { color: black; }

        .theme-toggle {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: transparent;
            border: 1px solid rgba(0,0,0,0.12);
            color: var(--text);
            cursor: pointer;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        [data-theme="dark"] .theme-toggle{ border-color: rgba(255,255,255,0.18); }
        .theme-toggle:hover{ border-color: var(--primary); }

        nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--card); border-top: 1px solid var(--border);
            display: flex; justify-content: space-around; padding: 0.5rem 0.1rem;
            z-index: 1000; box-shadow: 0 -4px 6px -1px rgba(0,0,0,0.05);
        }
        .nav-btn {
            background: none; border: none; color: var(--text-muted);
            display: flex; flex-direction: column; align-items: center;
            font-size: 0.5rem; cursor: pointer; flex: 1; gap: 2px;
        }
        .nav-btn.active { color: var(--accent); font-weight: 600; }
        .nav-btn svg { width: 18px; height: 18px; }

        main { max-width: 800px; margin: 1rem auto; padding: 0 1rem; }
        .section { display: none; }
        .section.active { display: block; animation: slideUp 0.3s ease-out; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card); border-radius: 16px; padding: 1.25rem; margin-bottom: 1rem; border: 1px solid var(--border); }
        .card-title { font-size: 1rem; font-weight: 700; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; font-size: 0.7rem; font-weight: 600; color: var(--text-muted); margin-bottom: 0.3rem; text-transform: uppercase; }
        
        input, select, textarea {
            width: 100%; padding: 0.6rem; border: 1px solid var(--border); border-radius: 8px; font-size: 0.9rem;
            background-color: var(--input-bg); color: var(--text);
        }
        input:focus, textarea:focus { outline: none; border-color: var(--accent); }

        .btn {
            padding: 0.6rem 1rem; border-radius: 8px; border: none; font-weight: 600; cursor: pointer;
            display: inline-flex; align-items: center; justify-content: center; gap: 0.4rem; font-size: 0.85rem;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-accent { background: var(--accent); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        .btn-danger-outline { background: transparent; border: 1px solid var(--danger); color: var(--danger); }
        .btn-block { width: 100%; }

        .cat-progress-container { margin-top: 8px; margin-bottom: 12px; }
        .cat-progress-bg { height: 6px; background: var(--border); border-radius: 10px; overflow: hidden; }
        .cat-progress-fill { height: 100%; background: var(--accent); transition: width 0.4s; }
        .cat-progress-fill.over { background: var(--danger); }
        .cat-progress-label { display: flex; justify-content: space-between; font-size: 0.65rem; color: var(--text-muted); margin-top: 4px; font-weight: 600; }

        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid var(--border); }
        .list-item-main { flex: 1; }
        .list-item-title { font-weight: 700; font-size: 0.9rem; }
        .list-item-sub { font-size: 0.75rem; color: var(--text-muted); }
        .list-item-values { text-align: right; margin-right: 1rem; }
        .list-item-base { font-weight: 800; font-size: 0.9rem; }
        .list-item-orig { font-size: 0.7rem; color: var(--text-muted); }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 1rem; max-width: 300px; margin-left: auto; margin-right: auto; }
        .cal-day-head { font-size: 0.5rem; text-align: center; color: var(--text-muted); font-weight: 800; padding-bottom: 2px; }
        .cal-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; border-radius: 4px; cursor: pointer; position: relative; background: var(--bg); border: 1px solid var(--border); }
        
        /* Styl dla dzisiejszego dnia */
        .cal-day.today-highlight { 
            border: 2px solid var(--accent); 
            color: var(--accent); 
            font-weight: 900;
            background: rgba(221, 170, 79, 0.1);
        }
        
        .cal-day.selected { background: var(--primary); color: white; border-color: var(--primary); z-index: 2; }
        .cal-day.has-content::after { content: ''; position: absolute; bottom: 2px; left: 20%; right: 20%; height: 1.5px; background: currentColor; border-radius: 1px; opacity: 0.6; }

        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 1rem; }
        .stat-item { background: var(--primary); color: white; padding: 0.75rem; border-radius: 12px; }
        .stat-val { display: block; font-size: 1rem; font-weight: 800; color: var(--accent); }
        .stat-label { font-size: 0.6rem; font-weight: 600; opacity: 0.8; text-transform: uppercase; }

        .progress-bar { height: 8px; background: var(--border); border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: var(--success); transition: width 0.4s; }

        .summary-sub { background: var(--primary-dark); color: white; padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.8rem; margin-top: 0.5rem; display: flex; justify-content: space-between; align-items: center; }

        .selector-strip { display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 0.5rem; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 1rem; }
        .selector-btn { background: none; border: none; color: var(--primary); cursor: pointer; font-size: 1.2rem; padding: 0 10px; }
        .sub-selector { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 1rem; scrollbar-width: none; }
        .sub-selector::-webkit-scrollbar { display: none; }
        .sub-btn { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 0.4rem 0.8rem; font-size: 0.75rem; font-weight: 600; cursor: pointer; white-space: nowrap; color: var(--text-muted); }
        .sub-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .journal-entry { display: flex; gap: 10px; margin-bottom: 0.75rem; align-items: flex-start; }
        .journal-hour { font-size: 0.65rem; font-weight: 800; color: var(--text-muted); width: 40px; text-align: right; padding-top: 8px; }
        .journal-textarea { flex: 1; min-height: 40px; padding: 8px; border-radius: 8px; font-size: 0.85rem; border: 1px solid var(--border); resize: none; overflow: hidden; }

        #print-view { display: none; }

        /* Onboarding (first-run guide) */
        .onboarding-overlay{
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.45);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 2000;
        }
        .onboarding-overlay.show{ display: flex; }

        .onboarding-card{
            width: 100%;
            max-width: 520px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 18px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.25);
            overflow: hidden;
        }
        .onboarding-head{
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }
        .onboarding-title{
            font-weight: 900;
            letter-spacing: .2px;
            font-size: 0.95rem;
            margin: 0;
        }
        .onboarding-close{
            width: 34px;
            height: 34px;
            border-radius: 10px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
        }
        .onboarding-close:hover{ border-color: var(--accent); }

        .onboarding-body{ padding: 16px; }
        .onboarding-kicker{
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 900;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.65rem;
            margin-bottom: 10px;
        }
        .onboarding-step-title{ font-size: 1.05rem; font-weight: 900; margin: 0 0 6px 0; }
        .onboarding-step-text{ margin: 0; color: var(--text-muted); font-size: 0.9rem; line-height: 1.45; }

        .onboarding-dots{
            display: flex;
            gap: 6px;
            justify-content: center;
            padding: 0 16px 10px 16px;
        }
        .onboarding-dot{
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--border);
        }
        .onboarding-dot.active{ background: var(--accent); }

        .onboarding-foot{
            padding: 12px 16px 16px 16px;
            display: flex;
            gap: 10px;
        }
        .onboarding-foot .btn{ flex: 1; }

        @media (max-width: 380px){
            .onboarding-step-title{ font-size: 1rem; }
            .onboarding-step-text{ font-size: 0.85rem; }
        }
        @media print {
            nav, header, .no-print, .btn, main { display: none !important; }
            #print-view { display: block !important; padding: 20px; color: black; background: white; font-size: 11pt; }
            .print-header { border-bottom: 2px solid #29606D; padding-bottom: 10px; margin-bottom: 20px; }
            .print-section { margin-bottom: 25px; page-break-inside: avoid; }
            .print-section h2 { color: #29606D; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px; margin-bottom: 10px; font-size: 14pt; }
            table { width: 100%; border-collapse: collapse; margin-top: 10px; }
            th, td { border: 1px solid #e2e8f0; padding: 8px; text-align: left; }
            th { background-color: #f8fafc; font-weight: bold; }
        }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body data-theme="light">
    <header class="no-print">
        <div class="header-top">
            <a class="brand" href="/" aria-label="Travel Rules home">
                <span class="brand-mark" aria-hidden="true">TR</span>
                <span class="brand-name">Travel Rules</span>
            </a>

            <div class="settings-bar">
                <button class="theme-toggle" id="theme-btn" type="button" aria-label="Toggle theme" title="Toggle theme">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" id="theme-icon-svg"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                </button>
                <select id="lang-select" class="settings-select" aria-label="Language">
                    <option value="pl">PL</option>
                    <option value="en">EN</option>
                    <option value="es">ES</option>
                </select>
            </div>
        </div>
    </header>

    <main id="main-content" class="no-print">
        <!-- Tab Budget -->
        <section id="tab-budget" class="section active">
            <div class="card">
                <div class="card-title" id="ui-trip-params">Parametry Podróży</div>
                <div class="form-group"><label id="ui-trip-name-label">Nazwa wyjazdu</label><input type="text" id="trip-name"></div>
                <div class="grid">
                    <div class="form-group"><label id="ui-from-label">Od</label><input type="date" id="trip-start"></div>
                    <div class="form-group"><label id="ui-to-label">Do</label><input type="date" id="trip-end"></div>
                </div>
                <div class="grid">
                    <div class="form-group"><label id="ui-base-currency-label">Waluta główna</label><select id="trip-currency"><option value="PLN">PLN</option><option value="EUR">EUR</option><option value="USD">USD</option><option value="GBP">GBP</option></select></div>
                    <div class="form-group"><label id="ui-total-budget-label">Budżet całkowity</label><input type="text" inputmode="decimal" id="trip-total"></div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-item"><span class="stat-label" id="ui-days-label">Dni</span><span class="stat-val" id="stats-days">0</span></div>
                <div class="stat-item"><span class="stat-label" id="ui-daily-label">Dziennie</span><span class="stat-val" id="stats-daily">0.00</span></div>
            </div>
            <div class="card">
                <div class="card-title" id="ui-planned-cats">Planowane Kategorie</div>
                <div id="category-list"></div>
                <div class="grid" style="grid-template-columns: 1fr 1fr auto; margin-top: 1rem;">
                    <input type="text" id="new-cat-name" placeholder="...">
                    <input type="text" inputmode="decimal" id="new-cat-amount" placeholder="0.00">
                    <button class="btn btn-accent" id="btn-add-cat">+</button>
                </div>
            </div>
            <button class="btn btn-outline btn-block" style="color:var(--danger);" id="btn-reset">Zresetuj wszystko</button>
        </section>

        <!-- Tab Expenses -->
        <section id="tab-expenses" class="section">
            <div class="card">
                <div class="card-title" id="ui-add-expense">Dodaj Wydatek</div>
                <div class="grid">
                    <div class="form-group"><label id="ui-exp-date-label">Kiedy</label><input type="date" id="exp-date"></div>
                    <div class="form-group"><label id="ui-exp-title-label">Nazwa</label><input type="text" id="exp-title"></div>
                </div>
                <div class="grid">
                    <div class="form-group"><label id="ui-exp-cat-label">Kategoria</label><select id="exp-cat"></select></div>
                    <div class="form-group"><label id="ui-exp-amount-label">Kwota</label><input type="text" inputmode="decimal" id="exp-amount"></div>
                </div>
                <div class="grid">
                    <div class="form-group"><label id="ui-exp-currency-label">Waluta</label><select id="exp-currency"></select></div>
                    <div class="form-group" id="exp-fx-group" style="display:none;"><label id="ui-exp-fx-label">Kurs</label><input type="text" inputmode="decimal" id="exp-fx"></div>
                </div>
                <button class="btn btn-primary btn-block" id="btn-add-exp">Dodaj</button>
            </div>
            <div class="card"><div class="card-title" id="ui-history-label">Historia</div><div id="expenses-list"></div></div>
        </section>

        <!-- Tab Fuel -->
        <section id="tab-fuel" class="section">
            <div class="card">
                <div class="card-title" id="ui-fuel-calc">Kalkulator Paliwa</div>
                <div class="grid">
                    <div class="form-group"><label id="ui-fuel-dist-label">Dystans (km)</label><input type="text" inputmode="decimal" id="fuel-dist"></div>
                    <div class="form-group"><label id="ui-fuel-cons-label">Spalanie (L/100km)</label><input type="text" inputmode="decimal" id="fuel-cons"></div>
                </div>
                <div class="grid">
                    <div class="form-group"><label id="ui-fuel-price-label">Cena za litr</label><input type="text" inputmode="decimal" id="fuel-price"></div>
                    <div class="form-group"><label id="ui-fuel-currency-label">Waluta</label><select id="fuel-currency"></select></div>
                </div>
                <div class="form-group" id="fuel-fx-group" style="display:none;">
                    <label id="ui-fuel-fx-label">Kurs waluty paliwa</label>
                    <input type="text" inputmode="decimal" id="fuel-fx">
                </div>
                <div style="background: var(--primary); color: white; padding: 1rem; border-radius: 12px; text-align: center;">
                    <div id="ui-est-fuel-cost-text" style="font-size: 0.7rem; opacity: 0.8;">SZACOWANY KOSZT TRASY</div>
                    <div style="font-size: 1.5rem; font-weight: 800; color: var(--accent);"><span id="res-fuel-cost-only">0.00</span> <span class="base-curr-label"></span></div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title" id="ui-refuel-card-title">Tankowanie</div>
                <div class="grid">
                    <div class="form-group"><label id="ui-refuel-date-label">Kiedy</label><input type="date" id="refuel-date"></div>
                    <div class="form-group"><label id="ui-refuel-name-label">Nazwa</label><input type="text" id="refuel-name"></div>
                </div>
                <div class="grid">
                    <div class="form-group"><label id="ui-refuel-amount-label">Kwota</label><input type="text" inputmode="decimal" id="refuel-amount"></div>
                    <div class="form-group"><label id="ui-refuel-currency-label">Waluta</label><select id="refuel-currency"></select></div>
                </div>
                <div class="form-group" id="refuel-fx-group" style="display:none;"><label id="ui-refuel-fx-label">Kurs</label><input type="text" inputmode="decimal" id="refuel-fx"></div>
                <button class="btn btn-accent btn-block" id="btn-add-refuel">Dodaj Tankowanie</button>
                <div class="summary-sub"><span id="ui-refuel-sum-label">SUMA TANKOWANIA:</span><span style="font-weight:800"><span id="total-refuel-val">0.00</span> <span class="base-curr-label"></span></span></div>
                <div id="refuel-list" style="margin-top: 1rem;"></div>
            </div>

            <div class="card">
                <div class="card-title" id="ui-tolls-title">Opłaty, autostrady, bramki</div>
                <div class="grid">
                    <div class="form-group"><label id="ui-toll-date-label">Kiedy</label><input type="date" id="toll-date"></div>
                    <div class="form-group"><label id="ui-toll-name-label">Nazwa</label><input type="text" id="toll-name"></div>
                </div>
                <div class="grid">
                    <div class="form-group"><label id="ui-toll-amount-label">Kwota</label><input type="text" inputmode="decimal" id="toll-amount"></div>
                    <div class="form-group"><label id="ui-toll-currency-label">Waluta</label><select id="toll-currency"></select></div>
                </div>
                <div class="form-group" id="toll-fx-group" style="display:none;"><label id="ui-toll-fx-label">Kurs</label><input type="text" inputmode="decimal" id="toll-fx"></div>
                <button class="btn btn-primary btn-block" id="btn-add-toll">Dodaj Opłatę</button>
                <div class="summary-sub"><span id="ui-tolls-sum-label">SUMA OPŁAT:</span><span style="font-weight:800"><span id="total-tolls-val">0.00</span> <span class="base-curr-label"></span></span></div>
                <div id="tolls-list" style="margin-top: 1rem;"></div>
            </div>
        </section>

        <!-- Tab Currencies -->
        <section id="tab-currencies" class="section">
            <div class="card">
                <div class="card-title" id="ui-converter-title">Szybki Przelicznik</div>
                <div class="grid" style="grid-template-columns: 2fr 1fr;">
                    <input type="text" inputmode="decimal" id="conv-amount" placeholder="0.00">
                    <select id="conv-from"></select>
                </div>
                <div id="conv-results" style="margin-top:1.25rem;"></div>
                <button class="btn btn-accent btn-sm btn-block" style="margin-top:1rem;" id="btn-refresh-rates">Aktualizuj kursy (Online)</button>
            </div>
            <div class="card"><div class="card-title" id="ui-rates-title">Kursy wymiany</div><div id="rates-list"></div></div>
        </section>

        <!-- Tab Journal -->
        <section id="tab-journal" class="section">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                   <span id="ui-journal-header-label" style="font-size: 0.8rem; font-weight: 800; opacity: 0.6;">DZIENNIK</span>
                   <span id="journal-display-title" style="font-size: 0.8rem; font-weight: 800; color: var(--accent);">...</span>
                </div>
                <div id="journal-calendar" class="calendar-grid"></div>
            </div>
            <div class="selector-strip">
                <button class="selector-btn" id="journal-month-prev">❮</button>
                <span id="journal-current-month" style="font-weight: 800; text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem;">...</span>
                <button class="selector-btn" id="journal-month-next">❯</button>
            </div>
            <div class="card"><div class="form-group"><label id="ui-journal-title-label">Tytuł / Lokalizacja (dziedziczona)</label><input type="text" id="journal-day-title"></div></div>
            <div class="sub-selector" id="journal-week-selector"></div>
            <div class="sub-selector" id="journal-day-selector"></div>
            <div class="card" id="journal-entries-container" style="padding: 1rem;"></div>
            <button class="btn btn-danger-outline btn-block" id="btn-clear-journal">Wyczyść cały dziennik</button>
        </section>

        <!-- Tab List -->
        <section id="tab-list" class="section">
            <div class="card">
                <div class="card-title" id="ui-packing-progress">Postęp pakowania</div>
                <div class="progress-bar"><div id="check-progress" class="progress-fill" style="width: 0%"></div></div>
                <div style="text-align: right; font-size: 0.75rem; font-weight: 700; color: var(--text-muted); margin-top: 5px;" id="check-stats">0/0</div>
            </div>
            <div id="checklist-content"></div>
            <div class="card">
                <div class="card-title" id="ui-add-to-list">Dodaj do listy</div>
                <div class="grid" style="grid-template-columns: 1fr 1fr auto;">
                    <input type="text" id="new-check-text" placeholder="...">
                    <select id="new-check-group"></select>
                    <button class="btn btn-accent" id="btn-add-check">+</button>
                </div>
            </div>
        </section>

        <!-- Tab PDF -->
        <section id="tab-pdf" class="section">
            <div class="card" style="text-align: center;">
                <h3 id="ui-pdf-title">Generowanie Raportu</h3>
                <div class="pdf-selection" style="text-align: left; margin: 1rem 0;">
                    <label class="pdf-option"><input type="checkbox" id="pdf-inc-budget-check" checked> <span id="ui-pdf-inc-budget">PARAMETRY & BUDŻET</span></label><br>
                    <label class="pdf-option"><input type="checkbox" id="pdf-inc-expenses-check" checked> <span id="ui-pdf-inc-expenses">WYDATKI RZECZYWISTE</span></label><br>
                    <label class="pdf-option"><input type="checkbox" id="pdf-inc-fuel-check" checked> <span id="ui-pdf-inc-fuel">TRANSPORT</span></label><br>
                    <label class="pdf-option"><input type="checkbox" id="pdf-inc-list-check" checked> <span id="ui-pdf-inc-list">LISTA RZECZY</span></label><br>
                    <div style="margin-top: 15px; border-top: 1px solid var(--border); padding-top: 15px;">
                        <label class="pdf-option"><input type="checkbox" id="pdf-inc-journal-check" checked> <span id="ui-pdf-inc-journal">DZIENNIK</span></label>
                    </div>
                </div>
                <button class="btn btn-primary btn-block" id="btn-gen-pdf">EKSPORTUJ DO PDF</button>
            </div>
        </section>
    </main>

    <div id="print-view"></div>

    <!-- Onboarding (shown once on first run; reappears after Reset) -->
    <div id="onboarding" class="onboarding-overlay" role="dialog" aria-modal="true" aria-labelledby="onboarding-title" aria-hidden="true">
        <div class="onboarding-card" role="document">
            <div class="onboarding-head">
                <h2 class="onboarding-title" id="onboarding-title">Start</h2>
                <button class="onboarding-close" id="onboarding-close" type="button" aria-label="Close">✕</button>
            </div>
            <div class="onboarding-body">
                <div class="onboarding-kicker" id="onboarding-kicker">1/4</div>
                <h3 class="onboarding-step-title" id="onboarding-step-title">...</h3>
                <p class="onboarding-step-text" id="onboarding-step-text">...</p>
            </div>
            <div class="onboarding-dots" id="onboarding-dots" aria-hidden="true"></div>
            <div class="onboarding-foot">
                <button class="btn btn-outline" id="onboarding-prev" type="button">◀</button>
                <button class="btn btn-primary" id="onboarding-next" type="button">Next</button>
            </div>
        </div>
    </div>

    <nav class="no-print">
        <button class="nav-btn active" data-tab="budget"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg><span id="nav-budget">Budżet</span></button>
        <button class="nav-btn" data-tab="expenses"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg><span id="nav-expenses">Wydatki</span></button>
        <button class="nav-btn" data-tab="fuel"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82"></path></svg><span id="nav-fuel">Opłaty</span></button>
        <button class="nav-btn" data-tab="currencies"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg><span id="nav-rates">Kursy</span></button>
        <button class="nav-btn" data-tab="journal"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg><span id="nav-journal">Dziennik</span></button>
        <button class="nav-btn" data-tab="list"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg><span id="nav-list">Lista</span></button>
        <button class="nav-btn" data-tab="pdf"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16"></path></svg><span id="nav-pdf">PDF</span></button>
    </nav>
    <script>
      (function(){
        const STORAGE_LANG = 'tr_lang';
        const STORAGE_THEME = 'tr_theme';

        const dict = {
          pl: {
            page_title: 'Planer Podróży — Travel Rules',
            trip_params: 'Parametry Podróży',
            trip_name: 'Nazwa wyjazdu',
            from: 'Od',
            to: 'Do',
            base_currency: 'Waluta główna',
            total_budget: 'Budżet całkowity',
            days: 'Dni',
            per_day: 'Dziennie',
            planned_categories: 'Planowane Kategorie',
            reset_all: 'Zresetuj wszystko',

            add_expense: 'Dodaj Wydatek',
            when: 'Kiedy',
            name: 'Nazwa',
            category: 'Kategoria',
            amount: 'Kwota',
            currency: 'Waluta',
            exchange_rate: 'Kurs',
            add: 'Dodaj',
            history: 'Historia',

            fuel_calc: 'Kalkulator Paliwa',
            distance_km: 'Dystans (km)',
            consumption: 'Spalanie (L/100km)',
            price_per_liter: 'Cena za litr',
            fuel_fx: 'Kurs waluty paliwa',
            estimated_route_cost: 'SZACOWANY KOSZT TRASY',

            refuel: 'Tankowanie',
            add_refuel: 'Dodaj Tankowanie',
            refuel_total: 'SUMA TANKOWANIA:',

            tolls: 'Opłaty, autostrady, bramki',
            add_toll: 'Dodaj Opłatę',
            tolls_total: 'SUMA OPŁAT:',

            quick_converter: 'Szybki Przelicznik',
            refresh_rates: 'Aktualizuj kursy (Online)',
            exchange_rates: 'Kursy wymiany',

            journal: 'DZIENNIK',
            journal_title_location: 'Tytuł / Lokalizacja (dziedziczona)',
            clear_journal: 'Wyczyść cały dziennik',

            packing_progress: 'Postęp pakowania',
            add_to_list: 'Dodaj do listy',

            pdf_report: 'Generowanie Raportu',
            pdf_inc_budget: 'PARAMETRY & BUDŻET',
            pdf_inc_expenses: 'WYDATKI RZECZYWISTE',
            pdf_inc_transport: 'TRANSPORT',
            pdf_inc_list: 'LISTA RZECZY',
            pdf_inc_journal: 'DZIENNIK',
            export_pdf: 'EKSPORTUJ DO PDF',

            nav_budget: 'Budżet',
            nav_expenses: 'Wydatki',
            nav_fuel: 'Opłaty',
            nav_rates: 'Kursy',
            nav_journal: 'Dziennik',
            nav_list: 'Lista',
            nav_pdf: 'PDF',

            aria_theme: 'Przełącz motyw (jasny/ciemny)',
            aria_lang: 'Wybór języka',
            ob_title: 'Start w 60 sekund',
            ob_next: 'Dalej',
            ob_start: 'Zaczynamy',
            ob_close: 'Zamknij',
            ob_prev: 'Wstecz',
            ob_s1_k: '1/4',
            ob_s1_t: 'Ustaw wyjazd i budżet',
            ob_s1_b: 'W zakładce „Budżet” wpisz daty, walutę główną i budżet całkowity. Dodaj planowane kategorie (np. noclegi, jedzenie).',
            ob_s2_k: '2/4',
            ob_s2_t: 'Dodawaj realne wydatki',
            ob_s2_b: 'W „Wydatki” zapisuj koszty na bieżąco: data, nazwa, kategoria, kwota i waluta. Dzięki temu wiesz, gdzie uciekają pieniądze.',
            ob_s3_k: '3/4',
            ob_s3_t: 'Policz transport i opłaty',
            ob_s3_b: 'W „Opłaty” policz koszt paliwa oraz dodawaj tankowania i autostrady/peaje. Aplikacja sumuje transport.',
            ob_s4_k: '4/4',
            ob_s4_t: 'Lista, dziennik i PDF',
            ob_s4_b: 'Odhaczaj rzeczy w „Lista”, zapisuj notatki w „Dziennik”, a na końcu eksportuj raport w zakładce „PDF”.'
          },
          en: {
            page_title: 'Travel Planner — Travel Rules',
            trip_params: 'Trip parameters',
            trip_name: 'Trip name',
            from: 'From',
            to: 'To',
            base_currency: 'Base currency',
            total_budget: 'Total budget',
            days: 'Days',
            per_day: 'Per day',
            planned_categories: 'Planned categories',
            reset_all: 'Reset everything',

            add_expense: 'Add expense',
            when: 'When',
            name: 'Name',
            category: 'Category',
            amount: 'Amount',
            currency: 'Currency',
            exchange_rate: 'Exchange rate',
            add: 'Add',
            history: 'History',

            fuel_calc: 'Fuel calculator',
            distance_km: 'Distance (km)',
            consumption: 'Consumption (L/100km)',
            price_per_liter: 'Price per liter',
            fuel_fx: 'Fuel currency rate',
            estimated_route_cost: 'ESTIMATED ROUTE COST',

            refuel: 'Refueling',
            add_refuel: 'Add refuel',
            refuel_total: 'REFUEL TOTAL:',

            tolls: 'Tolls / highways / gates',
            add_toll: 'Add toll',
            tolls_total: 'TOLLS TOTAL:',

            quick_converter: 'Quick converter',
            refresh_rates: 'Refresh rates (Online)',
            exchange_rates: 'Exchange rates',

            journal: 'JOURNAL',
            journal_title_location: 'Title / Location (inherited)',
            clear_journal: 'Clear entire journal',

            packing_progress: 'Packing progress',
            add_to_list: 'Add to list',

            pdf_report: 'Generate report',
            pdf_inc_budget: 'PARAMETERS & BUDGET',
            pdf_inc_expenses: 'ACTUAL EXPENSES',
            pdf_inc_transport: 'TRANSPORT',
            pdf_inc_list: 'PACKING LIST',
            pdf_inc_journal: 'JOURNAL',
            export_pdf: 'EXPORT TO PDF',

            nav_budget: 'Budget',
            nav_expenses: 'Expenses',
            nav_fuel: 'Costs',
            nav_rates: 'Rates',
            nav_journal: 'Journal',
            nav_list: 'List',
            nav_pdf: 'PDF',

            aria_theme: 'Toggle theme (light/dark)',
            aria_lang: 'Language',
            ob_title: 'Start in 60 seconds',
            ob_next: 'Next',
            ob_start: 'Let\'s go',
            ob_close: 'Close',
            ob_prev: 'Back',
            ob_s1_k: '1/4',
            ob_s1_t: 'Set trip & budget',
            ob_s1_b: 'In “Budget”, enter dates, base currency and total budget. Add planned categories (e.g., accommodation, food).',
            ob_s2_k: '2/4',
            ob_s2_t: 'Log real expenses',
            ob_s2_b: 'In “Expenses”, add costs as you go: date, name, category, amount and currency. It keeps your spending under control.',
            ob_s3_k: '3/4',
            ob_s3_t: 'Calculate transport costs',
            ob_s3_b: 'In “Costs”, estimate fuel and add refuels plus tolls/highways. The app totals your transport.',
            ob_s4_k: '4/4',
            ob_s4_t: 'List, journal & PDF',
            ob_s4_b: 'Tick items in “List”, write notes in “Journal”, then export a report from the “PDF” tab.'
          },
          es: {
            page_title: 'Planificador de viaje — Travel Rules',
            trip_params: 'Parámetros del viaje',
            trip_name: 'Nombre del viaje',
            from: 'Desde',
            to: 'Hasta',
            base_currency: 'Moneda base',
            total_budget: 'Presupuesto total',
            days: 'Días',
            per_day: 'Por día',
            planned_categories: 'Categorías planificadas',
            reset_all: 'Restablecer todo',

            add_expense: 'Añadir gasto',
            when: 'Cuándo',
            name: 'Nombre',
            category: 'Categoría',
            amount: 'Importe',
            currency: 'Moneda',
            exchange_rate: 'Tipo de cambio',
            add: 'Añadir',
            history: 'Historial',

            fuel_calc: 'Calculadora de combustible',
            distance_km: 'Distancia (km)',
            consumption: 'Consumo (L/100km)',
            price_per_liter: 'Precio por litro',
            fuel_fx: 'Tipo de cambio del combustible',
            estimated_route_cost: 'COSTE ESTIMADO DE LA RUTA',

            refuel: 'Repostaje',
            add_refuel: 'Añadir repostaje',
            refuel_total: 'TOTAL REPOSTAJE:',

            tolls: 'Peajes / autopistas / barreras',
            add_toll: 'Añadir peaje',
            tolls_total: 'TOTAL PEAJES:',

            quick_converter: 'Convertidor rápido',
            refresh_rates: 'Actualizar tipos (Online)',
            exchange_rates: 'Tipos de cambio',

            journal: 'DIARIO',
            journal_title_location: 'Título / Ubicación (heredado)',
            clear_journal: 'Borrar todo el diario',

            packing_progress: 'Progreso de equipaje',
            add_to_list: 'Añadir a la lista',

            pdf_report: 'Generar informe',
            pdf_inc_budget: 'PARÁMETROS Y PRESUPUESTO',
            pdf_inc_expenses: 'GASTOS REALES',
            pdf_inc_transport: 'TRANSPORTE',
            pdf_inc_list: 'LISTA DE EQUIPAJE',
            pdf_inc_journal: 'DIARIO',
            export_pdf: 'EXPORTAR A PDF',

            nav_budget: 'Presupuesto',
            nav_expenses: 'Gastos',
            nav_fuel: 'Costes',
            nav_rates: 'Tipos',
            nav_journal: 'Diario',
            nav_list: 'Lista',
            nav_pdf: 'PDF',

            aria_theme: 'Cambiar tema (claro/oscuro)',
            aria_lang: 'Idioma',
            ob_title: 'Empieza en 60 segundos',
            ob_next: 'Siguiente',
            ob_start: 'Empezar',
            ob_close: 'Cerrar',
            ob_prev: 'Atrás',
            ob_s1_k: '1/4',
            ob_s1_t: 'Configura viaje y presupuesto',
            ob_s1_b: 'En “Presupuesto”, introduce fechas, moneda base y presupuesto total. Añade categorías planificadas (p. ej., alojamiento, comida).',
            ob_s2_k: '2/4',
            ob_s2_t: 'Registra gastos reales',
            ob_s2_b: 'En “Gastos”, añade costos durante el viaje: fecha, nombre, categoría, importe y moneda. Así controlas el gasto.',
            ob_s3_k: '3/4',
            ob_s3_t: 'Calcula transporte y peajes',
            ob_s3_b: 'En “Costes”, estima combustible y añade repostajes y peajes/autopistas. La app suma el transporte.',
            ob_s4_k: '4/4',
            ob_s4_t: 'Lista, diario y PDF',
            ob_s4_b: 'Marca cosas en “Lista”, escribe notas en “Diario” y al final exporta un informe desde la pestaña “PDF”.'
          }
        };

        const body = document.body;
        const htmlEl = document.documentElement;
        const themeBtn = document.getElementById('theme-btn');
        const langSelect = document.getElementById('lang-select');

        // Onboarding (first-run guide)
        const STORAGE_ONBOARD = 'tr_onboard_v1_done';
        const onboardingEl = document.getElementById('onboarding');
        const obTitleEl = document.getElementById('onboarding-title');
        const obKickerEl = document.getElementById('onboarding-kicker');
        const obStepTitleEl = document.getElementById('onboarding-step-title');
        const obStepTextEl = document.getElementById('onboarding-step-text');
        const obDotsEl = document.getElementById('onboarding-dots');
        const obPrevBtn = document.getElementById('onboarding-prev');
        const obNextBtn = document.getElementById('onboarding-next');
        const obCloseBtn = document.getElementById('onboarding-close');

        let obIndex = 0;
        let currentLang = 'en';

        function safeGet(k){ try { return localStorage.getItem(k); } catch(e){ return null; } }
        function safeSet(k,v){ try { localStorage.setItem(k,v); } catch(e){} }

        function detectLang(){
          const saved = safeGet(STORAGE_LANG);
          if (saved && dict[saved]) return saved;
          const nav = (navigator.language || 'en').toLowerCase();
          if (nav.startsWith('pl')) return 'pl';
          if (nav.startsWith('es')) return 'es';
          return 'en';
        }
        function detectTheme(){
          const saved = safeGet(STORAGE_THEME);
          if (saved === 'dark' || saved === 'light') return saved;
          const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          return prefersDark ? 'dark' : 'light';
        }

        function setTheme(theme){
          body.setAttribute('data-theme', theme === 'dark' ? 'dark' : 'light');
          safeSet(STORAGE_THEME, theme === 'dark' ? 'dark' : 'light');
        }

        function applyLang(lang){
          const t = dict[lang] || dict.en;
          htmlEl.setAttribute('lang', lang);
          document.title = t.page_title;
          if (langSelect) langSelect.value = lang;
          if (themeBtn){
            themeBtn.setAttribute('aria-label', t.aria_theme);
            themeBtn.setAttribute('title', t.aria_theme);
          }
          if (langSelect) langSelect.setAttribute('aria-label', t.aria_lang);

          const map = {
            'ui-trip-params': 'trip_params',
            'ui-trip-name-label': 'trip_name',
            'ui-from-label': 'from',
            'ui-to-label': 'to',
            'ui-base-currency-label': 'base_currency',
            'ui-total-budget-label': 'total_budget',
            'ui-days-label': 'days',
            'ui-daily-label': 'per_day',
            'ui-planned-cats': 'planned_categories',
            'btn-reset': 'reset_all',

            'ui-add-expense': 'add_expense',
            'ui-exp-date-label': 'when',
            'ui-exp-title-label': 'name',
            'ui-exp-cat-label': 'category',
            'ui-exp-amount-label': 'amount',
            'ui-exp-currency-label': 'currency',
            'ui-exp-fx-label': 'exchange_rate',
            'btn-add-exp': 'add',
            'ui-history-label': 'history',

            'ui-fuel-calc': 'fuel_calc',
            'ui-fuel-dist-label': 'distance_km',
            'ui-fuel-cons-label': 'consumption',
            'ui-fuel-price-label': 'price_per_liter',
            'ui-fuel-currency-label': 'currency',
            'ui-fuel-fx-label': 'fuel_fx',
            'ui-est-fuel-cost-text': 'estimated_route_cost',

            'ui-refuel-card-title': 'refuel',
            'ui-refuel-date-label': 'when',
            'ui-refuel-name-label': 'name',
            'ui-refuel-amount-label': 'amount',
            'ui-refuel-currency-label': 'currency',
            'ui-refuel-fx-label': 'exchange_rate',
            'btn-add-refuel': 'add_refuel',
            'ui-refuel-sum-label': 'refuel_total',

            'ui-tolls-title': 'tolls',
            'ui-toll-date-label': 'when',
            'ui-toll-name-label': 'name',
            'ui-toll-amount-label': 'amount',
            'ui-toll-currency-label': 'currency',
            'ui-toll-fx-label': 'exchange_rate',
            'btn-add-toll': 'add_toll',
            'ui-tolls-sum-label': 'tolls_total',

            'ui-converter-title': 'quick_converter',
            'btn-refresh-rates': 'refresh_rates',
            'ui-rates-title': 'exchange_rates',

            'ui-journal-header-label': 'journal',
            'ui-journal-title-label': 'journal_title_location',
            'btn-clear-journal': 'clear_journal',

            'ui-packing-progress': 'packing_progress',
            'ui-add-to-list': 'add_to_list',

            'ui-pdf-title': 'pdf_report',
            'ui-pdf-inc-budget': 'pdf_inc_budget',
            'ui-pdf-inc-expenses': 'pdf_inc_expenses',
            'ui-pdf-inc-fuel': 'pdf_inc_transport',
            'ui-pdf-inc-list': 'pdf_inc_list',
            'ui-pdf-inc-journal': 'pdf_inc_journal',
            'btn-gen-pdf': 'export_pdf',

            'nav-budget': 'nav_budget',
            'nav-expenses': 'nav_expenses',
            'nav-fuel': 'nav_fuel',
            'nav-rates': 'nav_rates',
            'nav-journal': 'nav_journal',
            'nav-list': 'nav_list',
            'nav-pdf': 'nav_pdf'
          };

          Object.keys(map).forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            const key = map[id];
            if (t[key] == null) return;
            el.textContent = t[key];
          });

          // placeholders (keep simple)
          const phIds = ['new-cat-name','new-check-text'];
          phIds.forEach(pid => {
            const el = document.getElementById(pid);
            if (el) el.setAttribute('placeholder', '...');
          });
          const phNum = ['new-cat-amount','conv-amount'];
          phNum.forEach(pid => {
            const el = document.getElementById(pid);
            if (el) el.setAttribute('placeholder', '0.00');
          });

          safeSet(STORAGE_LANG, lang);
          currentLang = lang;
          renderOnboarding(lang);
        }

        function shouldShowOnboarding(){
          try { return !localStorage.getItem(STORAGE_ONBOARD); } catch(e){ return true; }
        }
        function markOnboardingDone(){
          try { localStorage.setItem(STORAGE_ONBOARD, '1'); } catch(e){}
        }
        function clearOnboardingDone(){
          try { localStorage.removeItem(STORAGE_ONBOARD); } catch(e){}
        }

        function getOnboardingSlides(lang){
          const t = dict[lang] || dict.en;
          return [
            { k: t.ob_s1_k, title: t.ob_s1_t, body: t.ob_s1_b },
            { k: t.ob_s2_k, title: t.ob_s2_t, body: t.ob_s2_b },
            { k: t.ob_s3_k, title: t.ob_s3_t, body: t.ob_s3_b },
            { k: t.ob_s4_k, title: t.ob_s4_t, body: t.ob_s4_b }
          ];
        }

        function renderOnboarding(lang){
          if (!onboardingEl) return;
          const t = dict[lang] || dict.en;
          const slides = getOnboardingSlides(lang);
          const idx = Math.max(0, Math.min(obIndex, slides.length - 1));
          obIndex = idx;

          if (obTitleEl) obTitleEl.textContent = t.ob_title;
          if (obCloseBtn) obCloseBtn.setAttribute('aria-label', t.ob_close);
          if (obPrevBtn) obPrevBtn.textContent = '◀ ' + (t.ob_prev || 'Back');

          const s = slides[idx];
          if (obKickerEl) obKickerEl.textContent = s.k;
          if (obStepTitleEl) obStepTitleEl.textContent = s.title;
          if (obStepTextEl) obStepTextEl.textContent = s.body;

          // dots
          if (obDotsEl){
            obDotsEl.innerHTML = '';
            for (let i = 0; i < slides.length; i++){
              const d = document.createElement('div');
              d.className = 'onboarding-dot' + (i === idx ? ' active' : '');
              obDotsEl.appendChild(d);
            }
          }

          // buttons
          if (obPrevBtn) obPrevBtn.disabled = (idx === 0);
          if (obNextBtn){
            obNextBtn.textContent = (idx === slides.length - 1) ? t.ob_start : t.ob_next;
          }
        }

        function showOnboarding(){
          if (!onboardingEl) return;
          onboardingEl.classList.add('show');
          onboardingEl.setAttribute('aria-hidden','false');
          document.body.style.overflow = 'hidden';
          renderOnboarding(currentLang);
        }
        function hideOnboarding(){
          if (!onboardingEl) return;
          onboardingEl.classList.remove('show');
          onboardingEl.setAttribute('aria-hidden','true');
          document.body.style.overflow = '';
        }

        function wireOnboardingEvents(){
          if (!onboardingEl) return;

          if (obCloseBtn){
            obCloseBtn.addEventListener('click', () => {
              // If user closes early, we still mark it as done so it won't annoy.
              markOnboardingDone();
              hideOnboarding();
            });
          }

          // click outside card closes
          onboardingEl.addEventListener('click', (e) => {
            if (e.target === onboardingEl){
              markOnboardingDone();
              hideOnboarding();
            }
          });

          if (obPrevBtn){
            obPrevBtn.addEventListener('click', () => {
              obIndex = Math.max(0, obIndex - 1);
              renderOnboarding(currentLang);
            });
          }

          if (obNextBtn){
            obNextBtn.addEventListener('click', () => {
              const slides = getOnboardingSlides(currentLang);
              if (obIndex >= slides.length - 1){
                markOnboardingDone();
                hideOnboarding();
                return;
              }
              obIndex = Math.min(slides.length - 1, obIndex + 1);
              renderOnboarding(currentLang);
            });
          }

          // ESC closes
          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && onboardingEl.classList.contains('show')){
              markOnboardingDone();
              hideOnboarding();
            }
          });

          // Reset button should allow onboarding to appear again
          const resetBtn = document.getElementById('btn-reset');
          if (resetBtn){
            resetBtn.addEventListener('click', () => {
              clearOnboardingDone();
              // show again after reset action finishes
              setTimeout(() => {
                obIndex = 0;
                showOnboarding();
              }, 150);
            });
          }
        }

        // init
        const initialTheme = detectTheme();
        setTheme(initialTheme);
        const initialLang = detectLang();
        applyLang(initialLang);

        // onboarding init
        currentLang = initialLang;
        wireOnboardingEvents();
        if (shouldShowOnboarding()){
          obIndex = 0;
          showOnboarding();
        }

        // events
        if (themeBtn){
          themeBtn.addEventListener('click', () => {
            const now = body.getAttribute('data-theme') || 'light';
            setTheme(now === 'dark' ? 'light' : 'dark');
          });
        }
        if (langSelect){
          langSelect.addEventListener('change', (e) => applyLang(e.target.value));
        }
      })();
    </script>
    <script type="module" src="index.js"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>